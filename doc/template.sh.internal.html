<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>SCRIPTNAME Internal Documentation</title>
  <meta http-equiv="content-type"
        content="text/html; charset=utf-8" />
  <link rev="made"
        href="mailto:root@localhost" />
</head>
<body>
  <ul id="index">
    <li>
      <a href="#SCRIPTNAME-Internal-Documentation">SCRIPTNAME Internal
      Documentation</a>
      <ul>
        <li>
          <a href="#Template-Use">Template Use</a>
          <ul>
            <li><a href="#Block-Organization">Block Organization</a></li>
            <li><a href="#Variable-Naming-Convention">Variable Naming
            Convention</a></li>
            <li><a href="#Global-Variables">Global Variables</a></li>
            <li><a href="#Documentation-Format">Documentation Format</a></li>
          </ul>
        </li>
        <li>
          <a href="#Unit-Test-Functions">Unit Test Functions</a>
          <ul>
            <li><a href="#oneTimeSetuUp">oneTimeSetuUp</a></li>
            <li><a href="#oneTimeSetuUp1">oneTimeSetuUp</a></li>
            <li><a href="#testInitialConfig">testInitialConfig</a></li>
            <li><a href="#testLog">testLog</a></li>
            <li><a href="#testSysLog">testSysLog</a></li>
            <li><a href="#testErrorLog">testErrorLog</a></li>
            <li><a href="#testCleanUp">testCleanUp</a></li>
            <li><a href="#testUsage">testUsage</a></li>
            <li><a href="#testComFunctions">testComFunctions</a></li>
            <li><a href="#testScriptFunctions">testScriptFunctions</a></li>
          </ul>
        </li>
        <li>
          <a href="#Common-Script-Functions">Common Script Functions</a>
          <ul>
            <li><a href="#fCleanUp">fCleanUp</a></li>
            <li><a href="#fInternalDoc">fInternalDoc</a></li>
            <li><a href="#fUsage-pStyle">fUsage pStyle</a></li>
            <li><a href="#fFmtLog-pLevel-pMsg-pLine-pErr">fFmtLog pLevel
            "pMsg" pLine pErr</a></li>
            <li>
              <a href="#fLog-pLevel-pMsg-LINENO-pErr-extra-text">fLog pLevel
              "pMsg" [$LINENO] [pErr] [extra text...]</a>
              <ul>
                <li><a href="#fLog-Examples">fLog Examples:</a></li>
              </ul>
            </li>
            <li><a href="#fError-pMsg-LINENO-pErr">fError "pMsg" [$LINENO]
            [pErr]</a></li>
            <li><a href=
            "#fLog2--m-pMsg--p-pLevel--l-LINENO--e-pErr-extra">fLog2 -m pMsg
            [-p pLevel] [-l $LINENO] [-e pErr] [extra...]</a></li>
            <li><a href="#fError2--m-pMsg--l-LINENO--e-pErr">fError2 -m pMsg
            [-l $LINENO] [-e pErr]</a></li>
            <li><a href=
            "#fCheckDeps-pRequired-List-pOptional-List">fCheckDeps "pRequired
            List" "pOptional List"</a></li>
            <li><a href="#fSetComGlobals">fSetComGlobals</a></li>
          </ul>
        </li>
        <li>
          <a href="#Script-Functions">Script Functions</a>
          <ul>
            <li><a href="#fSetGlobals">fSetGlobals</a></li>
            <li><a href="#fValidateHostName">fValidateHostName</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
  <h1 id="SCRIPTNAME-Internal-Documentation">SCRIPTNAME Internal
  Documentation</h1>
  <h2 id="Template-Use">Template Use</h2>
  <p>* Copy template.sh to your script file.</p>
  <p>* Globally replace SCRIPTNAME to the name of your script file.</p>
  <p>* Update the getopts in the Get Args Section</p>
  <p>* Loop: document args (with POD), add tests, add validate function</p>
  <p>* Loop: add function tests, add functions</p>
  <h3 id="Block-Organization">Block Organization</h3>
  <pre><code> * Configuration - exit if errors
 * Get Args - exit if errors
 * Verify external progs - exit if errors
 * Run tests - if gpTest is set
 * Validate Args - exit if errors
 * Verify connections work - exit if errors
 * Read-only functional work - exit if errors
 * Write functional work - now you are committed! Try to keep going if errors
 * Output results and/or launch next process</code></pre>
  <p>To avoid a lot of rework or and manual rollbacks, put-off <i>writes</i>
  that cannot undone. Do as much as possible to make sure the script will be
  able to complete write operations.</p>
  <p>For example, <b>do not do this:</b> collect information, transform it,
  write it to a DB, then start the next process on another server. Whoops,
  that server cannot be accessed! Gee, why didn't you verify all the
  connections you will need, before committing to the DB?! Even if you did
  check the connection could fail after the check, so maybe write to a tmp
  DB, then when all is OK, update the master DB with the tmp DB changes.</p>
  <p>Where ever possible make your scripts "re-entrant". Connections can fail
  at anytime and scripts can be killed at anytime; How it any important work
  continued or work reverted?</p>
  <h3 id="Variable-Naming-Convention">Variable Naming Convention</h3>
  <p>Prefix codes are used to show the "scope" of variables):</p>
  <pre><code> gVar - global variable (may even be external to the script)
 pVar - a function parameter I&lt;local&gt;
 gpVar - global parameter, i.e. may be defined external to the script
 cVar - global constant (set once)
 tVar - temporary variable (usually I&lt;local&gt; to a function)
 fFun - function</code></pre>
  <p>All UPPERCASE variables are <i>only</i> used when they are required by
  other programs or scripts.</p>
  <h3 id="Global-Variables">Global Variables</h3>
  <p>For more help, see the Globals section in fUsage.</p>
  <pre><code> gpLog - -l
 gpVerbose - -v, -vv
 gpDebug - -x, -xx, ...
 gpTest - -t
 Tmp - personal tmp directory.  Usually set to: /tmp/$USER
 cTmpF - tmp file prefix.  Includes $$ to make it unique
 cTmp1 - a temp file with a pattern that fCleanUp will remove
 gErr - error code (0 = no error)
 cName - script's name taken from $0
 cCurDir - current directory
 cBin - directory where the script is executing from
 cVer - current version</code></pre>
  <h3 id="Documentation-Format">Documentation Format</h3>
  <p>POD is use to format the script's documentation. Sure MarkDown could
  have been used, but it didn't exist 20 years ago. POD text can be output as
  text, man, html, pdf, texi, just usage, and even MarkDown</p>
  <p>Help for POD can be found at: <a href=
  "https://perldoc.perl.org/perlpod">perlpod - the Plain Old Documentation
  format</a></p>
  <p>The documentation is embedded in the script so that it is more likely to
  be updated. Separate doc files seem to <i>always</i> drift from the code.
  Feel free to delete any documentation, if the code is clear enough. BUT
  <i>clean up your code</i> so that the code <i>really</i> is clear.</p>
  <p>The internal documentation uses POD commands that begin with
  "=internal-". See fInternalDoc() for how this is used.</p>
  <p>Also TDD (Test Driven Development) should make refactoring easy, because
  the tests are also embedded in the script.</p>
  <h2 id="Unit-Test-Functions">Unit Test Functions</h2>
  <h3 id="oneTimeSetuUp">oneTimeSetuUp</h3>
  <p>Currently this records all of the script's expected initial global
  variable settings, defined in fSetGlobals. If different, adjust the tests
  as needed.</p>
  <h3 id="oneTimeSetuUp1">oneTimeSetuUp</h3>
  <p>Before each test runs, this restores all of the script's initial global
  variable settings,</p>
  <h3 id="testInitialConfig">testInitialConfig</h3>
  <p>Verify all of the global variables are correctly defined.</p>
  <h3 id="testLog">testLog</h3>
  <p>Test fLog and fLog2.</p>
  <h3 id="testSysLog">testSysLog</h3>
  <p>Test fLog and fLog2, and verify messages are in a syslog file.</p>
  <h3 id="testErrorLog">testErrorLog</h3>
  <p>Test fError and fError2.</p>
  <h3 id="testCleanUp">testCleanUp</h3>
  <p>Test fCleanUp. Verify the tmp files are removed.</p>
  <h3 id="testUsage">testUsage</h3>
  <p>Test fUsage. Verify the different output styles work.</p>
  <h3 id="testComFunctions">testComFunctions</h3>
  <p>Just verify these functions exist.</p>
  <h3 id="testScriptFunctions">testScriptFunctions</h3>
  <p>This is just a starting point for creating script functionality
  tests.</p>
  <h2 id="Common-Script-Functions">Common Script Functions</h2>
  <h3 id="fCleanUp">fCleanUp</h3>
  <p>Called when script ends (see trap) to remove temporary files. Except if
  gpDebug != 0, then tmp files are not removed.</p>
  <h3 id="fInternalDoc">fInternalDoc</h3>
  <p>This function collects all of the "pod-internal" documentation.</p>
  <h3 id="fUsage-pStyle">fUsage pStyle</h3>
  <p>This function selects the type of help output. See -h and -H
  options.</p>
  <h3 id="fFmtLog-pLevel-pMsg-pLine-pErr">fFmtLog pLevel "pMsg" pLine
  pErr</h3>
  <p>This function formats and outputs a consistent log message output. See:
  fLog, fLog2, fError, and fError2.</p>
  <h3 id="fLog-pLevel-pMsg-LINENO-pErr-extra-text">fLog pLevel "pMsg"
  [$LINENO] [pErr] [extra text...]</h3>
  <p>pLevel - emerg alert crit err warning notice info debug debug-N</p>
  <p>See Globals: gpLog, gpFacility, gpVerbose, gpDebug</p>
  <h4 id="fLog-Examples">fLog Examples:</h4>
  <pre><code> fLog notice "Just testing" $LINENO 8 "added to msg"
 fLog debug "Output only if $gpDebug&gt;0" $LINENO
 fLog debug-3 "Output only if $gpDebug&gt;0 and $gpDebug&lt;=3" $LINENO
 </code></pre>
  <h3 id="fError-pMsg-LINENO-pErr">fError "pMsg" [$LINENO] [pErr]</h3>
  <p>This will call: fLog crit "pMsg" pLine pErr</p>
  <p>Then it will call "fUsage short", which will exit after fCleanUp.</p>
  <h3 id="fLog2--m-pMsg--p-pLevel--l-LINENO--e-pErr-extra">fLog2 -m pMsg [-p
  pLevel] [-l $LINENO] [-e pErr] [extra...]</h3>
  <p>This is like fLog, but the arguments can be in any order.</p>
  <p>See fLog. See also global gpFacility</p>
  <h3 id="fError2--m-pMsg--l-LINENO--e-pErr">fError2 -m pMsg [-l $LINENO] [-e
  pErr]</h3>
  <p>This will call: fLog2 -p crit -m "pMsg" -l pLine -e pErr</p>
  <p>Then it will call "fUsage short", which will exit after fCleanUp.</p>
  <h3 id="fCheckDeps-pRequired-List-pOptional-List">fCheckDeps "pRequired
  List" "pOptional List"</h3>
  <p>Check for required and optional programs or scripts used by this script.
  If any required programs are missing, exit the script.</p>
  <h3 id="fSetComGlobals">fSetComGlobals</h3>
  <p>Set initial values for all of the globals use by this script. The ones
  that begin with "gp" can usually be overridden by setting them before the
  script is run.</p>
  <h2 id="Script-Functions">Script Functions</h2>
  <h3 id="fSetGlobals">fSetGlobals</h3>
  <p>Set initial values for all of the globals use by this script. The ones
  that begin with "gp" can usually be overridden by setting them before the
  script is run.</p>
  <h3 id="fValidateHostName">fValidateHostName</h3>
  <p>Exit if missing.</p>
</body>
</html>
